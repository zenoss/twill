<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.7: http://docutils.sourceforge.net/" />
<title>twill: an extensible scriptlet language for testing web apps</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="twill-an-extensible-scriptlet-language-for-testing-web-apps">
<h1 class="title">twill: an extensible scriptlet language for testing web apps</h1>
<div class="contents topic" id="contents">
<p class="topic-title first"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#what-is-twill" id="id1" name="id1">What is 'twill'?</a><ul>
<li><a class="reference" href="#use-cases" id="id2" name="id2">Use cases</a></li>
</ul>
</li>
<li><a class="reference" href="#command-reference" id="id3" name="id3">Command Reference</a><ul>
<li><a class="reference" href="#browsing" id="id4" name="id4">Browsing</a></li>
<li><a class="reference" href="#assertions" id="id5" name="id5">Assertions</a></li>
<li><a class="reference" href="#display" id="id6" name="id6">Display</a></li>
<li><a class="reference" href="#forms" id="id7" name="id7">Forms</a></li>
<li><a class="reference" href="#cookies" id="id8" name="id8">Cookies</a></li>
<li><a class="reference" href="#other-commands" id="id9" name="id9">Other commands</a></li>
<li><a class="reference" href="#special-variables" id="id10" name="id10">Special variables</a></li>
</ul>
</li>
<li><a class="reference" href="#requirements-availability-and-licensing" id="id11" name="id11">Requirements, Availability and Licensing</a><ul>
<li><a class="reference" href="#licensing" id="id12" name="id12">Licensing</a></li>
</ul>
</li>
<li><a class="reference" href="#installation-and-examples" id="id13" name="id13">Installation and Examples</a><ul>
<li><a class="reference" href="#recording-scripts" id="id14" name="id14">Recording scripts</a></li>
</ul>
</li>
<li><a class="reference" href="#implementation-and-extending-twill" id="id15" name="id15">Implementation and Extending Twill</a><ul>
<li><a class="reference" href="#extending-twill" id="id16" name="id16">Extending twill</a></li>
<li><a class="reference" href="#using-twill-in-other-python-programs" id="id17" name="id17">Using twill in other Python programs</a></li>
<li><a class="reference" href="#miscellaneous-implementation-details" id="id18" name="id18">Miscellaneous Implementation Details</a></li>
</ul>
</li>
<li><a class="reference" href="#why-reimplement-pbp" id="id19" name="id19">Why Reimplement PBP?</a></li>
<li><a class="reference" href="#future-plans" id="id20" name="id20">Future Plans</a></li>
<li><a class="reference" href="#acknowledgements-and-credits" id="id21" name="id21">Acknowledgements and Credits</a></li>
</ul>
</div>
<div class="section" id="what-is-twill">
<h1><a class="toc-backref" href="#id1" name="what-is-twill">What is 'twill'?</a></h1>
<p>twill is a reimplementation of <a class="reference" href="http://pbp.berlios.de/">PBP</a>, the &quot;Python Browser Poseur&quot;.
twill and PBP both let you execute scripts that looks something like
this:</p>
<pre class="literal-block">
# go to my Quixote demo page
go http://issola.caltech.edu/~t/qwsgi/qwsgi-demo.cgi/

# go to the widgets sub-page
go ./widgets
showforms

# fill out the form
formclear 1
fv 1 name test
fv 1 password testpass
fv 1 confirm yes
showforms

# submit form
submit 0

# show results
show

# confirm success, etc.
code 200
find testpass
</pre>
<p>The primary use for twill (as with PBP) is to do automated testing of
Web applications via a straightforward declarative language.  In
addition to basic Web crawling, I wanted to be able to extend the
language via Python, and I also wanted to be able to record things
with <a class="reference" href="http://maxq.tigris.org/">maxq</a>.  Hence, twill.</p>
<div class="section" id="use-cases">
<h2><a class="toc-backref" href="#id2" name="use-cases">Use cases</a></h2>
<p>Here are some of things that I'm using twill for, or that I plan to use
it for:</p>
<blockquote>
<ul class="simple">
<li>checking that Web sites are alive;</li>
<li>testing functionality in my Quixote extensions;</li>
<li>demonstrating specific problems with my (and other) Web sites;</li>
<li>regression testing of Web projects, and making sure that existing
projects work like they should;</li>
<li>interacting with Mailman lists;</li>
</ul>
</blockquote>
<p>Send me an e-mail if you have additional ideas.</p>
</div>
</div>
<div class="section" id="command-reference">
<h1><a class="toc-backref" href="#id3" name="command-reference">Command Reference</a></h1>
<p>The following commands are built into twill.</p>
<div class="section" id="browsing">
<h2><a class="toc-backref" href="#id4" name="browsing">Browsing</a></h2>
<p><strong>go</strong> <em>&lt;url&gt;</em> -- visit the given URL.</p>
<p><strong>back</strong> -- return to the previous URL.</p>
<p><strong>reload</strong> -- reload the current URL.</p>
<p><strong>follow</strong> <em>&lt;link name&gt;</em> -- follow the given link.</p>
</div>
<div class="section" id="assertions">
<h2><a class="toc-backref" href="#id5" name="assertions">Assertions</a></h2>
<p><strong>code</strong> <em>&lt;code&gt;</em> -- assert that the last page loaded had this HTTP status,
e.g. <tt class="docutils literal"><span class="pre">code</span> <span class="pre">200</span></tt> asserts that the page loaded fine.</p>
<p><strong>find</strong> <em>&lt;regexp&gt;</em> -- assert that the page contains this regular expression.</p>
<p><strong>notfind</strong> <em>&lt;regexp&gt;</em> -- assert that the page <em>does not</em> contain this
regular expression.</p>
</div>
<div class="section" id="display">
<h2><a class="toc-backref" href="#id6" name="display">Display</a></h2>
<p><strong>show</strong> -- show the current page's HTML.</p>
<p><strong>echo</strong> <em>&lt;string&gt;</em> -- echo the string to the screen via 'print'.</p>
</div>
<div class="section" id="forms">
<h2><a class="toc-backref" href="#id7" name="forms">Forms</a></h2>
<p><strong>showforms</strong> -- show all of the forms on the page.</p>
<p><strong>submit</strong> <em>[&lt;n&gt;]</em> -- click the n'th submit button, if given; otherwise
submit via the last submission button clicked; if nothing clicked, use
the first submit button on the form.</p>
<p><strong>formvalue</strong> <em>&lt;formnum&gt; &lt;fieldname&gt; &lt;value&gt;</em> --- set the given field in the
given form to the given value.  For read-only form widgets/controls, the
click may be recorded for use by <strong>submit</strong>, but the value is not changed.</p>
<p><strong>fv</strong> -- abbreviation for 'formvalue'</p>
<p><strong>formclear</strong> -- clear all values in the form.</p>
</div>
<div class="section" id="cookies">
<h2><a class="toc-backref" href="#id8" name="cookies">Cookies</a></h2>
<p><strong>save_cookies</strong> <em>&lt;filename&gt;</em> -- save current cookie jar into a file.</p>
<p><strong>load_cookies</strong> <em>&lt;filename&gt;</em> -- replace current cookie jar with file contents.</p>
<p><strong>clear_cookies</strong> -- clear all of the current cookies.</p>
<p><strong>show_cookies</strong> -- show all of the current cookies.</p>
</div>
<div class="section" id="other-commands">
<h2><a class="toc-backref" href="#id9" name="other-commands">Other commands</a></h2>
<p><strong>sleep</strong> <em>[&lt;seconds&gt;]</em> -- sleep the given number of seconds.  Defaults to 1 second.</p>
<p><strong>reset_state</strong> -- reset the browser.</p>
<p><strong>extend_with</strong> <em>&lt;module&gt;</em> -- import commands from Python module.</p>
<p><strong>getinput</strong> <em>&lt;prompt&gt;</em> -- get keyboard input and store it in <tt class="docutils literal"><span class="pre">__input__</span></tt>.</p>
<p><strong>getpassword</strong> <em>&lt;prompt&gt;</em> -- get <em>silent</em> keyboard input and store
it in <tt class="docutils literal"><span class="pre">__password__</span></tt>.</p>
</div>
<div class="section" id="special-variables">
<h2><a class="toc-backref" href="#id10" name="special-variables">Special variables</a></h2>
<p><strong>__input__</strong> -- result of last <strong>getinput</strong></p>
<p><strong>__password__</strong> -- result of last <strong>getpassword</strong></p>
</div>
</div>
<div class="section" id="requirements-availability-and-licensing">
<h1><a class="toc-backref" href="#id11" name="requirements-availability-and-licensing">Requirements, Availability and Licensing</a></h1>
<p>twill is developed in python 2.3, and should work fine with python 2.4.
You don't need any other software; both <a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> and <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> are
required but included with twill.</p>
<p>Version 0.7 (&quot;more things work&quot;) is available for
download <a class="reference" href="http://darcs.idyll.org/~t/projects/twill-0.7.tar.gz">here</a>.  The latest development version can be found at
<a class="reference" href="http://darcs.idyll.org/~t/projects/twill-latest.tar.gz">twill-latest.tar.gz</a>.  There's a darcs repository for the project at
<a class="reference" href="http://darcs.idyll.org/~t/projects/twill/">http://darcs.idyll.org/~t/projects/twill/</a>.</p>
<div class="section" id="licensing">
<h2><a class="toc-backref" href="#id12" name="licensing">Licensing</a></h2>
<p>twill 0.7 is licensed under the <a class="reference" href="http://www.gnu.org/copyleft/lesser.html">GNU LGPL</a>, although I am amenable to
changing to an MIT-like license in the future.  All code currently
contained in twill is Copyright (C) 2005, C. Titus Brown
&lt;<a class="reference" href="mailto:titus&#64;caltech.edu">titus&#64;caltech.edu</a>&gt;.</p>
<p>In plain English: I own the code, but you're welcome to use it and
even subsume it into other projects.  Either way you are currently
obligated to make any changes to twill publicly available, in source
code form, if and only if you are distributing those changes in some
<em>other</em> form (e.g. as part of another package).  You do <em>not</em> need to
provide the source to packages that use twill, and you are not
obligated to publish your own private changes to twill, or twill scripts,
or twill extensions.</p>
<p><a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> and <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> are both included with twill, but are under
their own licenses.  (Both are currently more lenient than the LGPL,
so you should have no problems.)</p>
</div>
</div>
<div class="section" id="installation-and-examples">
<h1><a class="toc-backref" href="#id13" name="installation-and-examples">Installation and Examples</a></h1>
<p>To install twill, just run</p>
<pre class="literal-block">
python setup.py install
</pre>
<p>To run twill, type 'twill-sh' and try</p>
<pre class="literal-block">
go http://www.python.org/
show
</pre>
<p>You can also run scripts (e.g. the files in <tt class="docutils literal"><span class="pre">examples/</span></tt>) directly by
specifying them on the command line.</p>
<p>There are several examples under the <tt class="docutils literal"><span class="pre">examples/</span></tt> subdirectory.  Included
in the examples is a test of the Quixote demo site, and a script for
clearing out SourceForge Mailman lists.  The latter script makes use of the
(very simple!) extension feature, if you're interested...</p>
<div class="section" id="recording-scripts">
<h2><a class="toc-backref" href="#id14" name="recording-scripts">Recording scripts</a></h2>
<p>Writing twill scripts is boring.  One simple way to get at least a
rough initial script is to use the <a class="reference" href="http://maxq.tigris.org/">maxq</a> recorder to generate a twill
script.  <a class="reference" href="http://maxq.tigris.org/">maxq</a> acts as an HTTP proxy and records all HTTP traffic; I
have written a simple twill script generator for it.  The script
generator and installation docs are included in the twill distribution
under the directory <tt class="docutils literal"><span class="pre">maxq/</span></tt>.</p>
</div>
</div>
<div class="section" id="implementation-and-extending-twill">
<h1><a class="toc-backref" href="#id15" name="implementation-and-extending-twill">Implementation and Extending Twill</a></h1>
<p>twill is pretty small at the moment, and I'm hoping to keep the core
of it very simple.  twill is essentially a thin shell around the
<a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> package.  All twill commands are implemented in the
<tt class="docutils literal"><span class="pre">commands.py</span></tt> file, and <a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> does the work of parsing the
input and converting it into Python commands (see <tt class="docutils literal"><span class="pre">parse.py</span></tt>).
Interactive shell work and readline support is implemented via the
<a class="reference" href="http://docs.python.org/lib/module-cmd.html">cmd</a> module (from the standard Python library).</p>
<div class="section" id="extending-twill">
<h2><a class="toc-backref" href="#id16" name="extending-twill">Extending twill</a></h2>
<p>Right now twill is very easy to extend: just build a Python module
that exports the functions you want to call, place it in the
PYTHONPATH, and run <tt class="docutils literal"><span class="pre">extend_with</span> <span class="pre">&lt;modulename&gt;</span></tt>.  See
<tt class="docutils literal"><span class="pre">extensions/mailman_sf.py</span></tt> for an extension that helps deal
with mailman lists on SourceForge; this extension is used by
<tt class="docutils literal"><span class="pre">examples/discard-sf-mailman-msgs</span></tt>.</p>
<p>Notes:</p>
<blockquote>
<ul class="simple">
<li>If your extension raises <tt class="docutils literal"><span class="pre">SystemExit</span></tt>, twill will stop
processing the script.  This is a useful way to build in
conditionals, e.g. see the <tt class="docutils literal"><span class="pre">discard-sf-mailman-msgs</span></tt> example
script.</li>
</ul>
</blockquote>
</div>
<div class="section" id="using-twill-in-other-python-programs">
<h2><a class="toc-backref" href="#id17" name="using-twill-in-other-python-programs">Using twill in other Python programs</a></h2>
<p>twill also provides a simple wrapper for <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> functionality, in
the <cite>commands.py</cite> module.  This may be useful for twill extensions as
well as for other toolkits.</p>
</div>
<div class="section" id="miscellaneous-implementation-details">
<h2><a class="toc-backref" href="#id18" name="miscellaneous-implementation-details">Miscellaneous Implementation Details</a></h2>
<blockquote>
<ul class="simple">
<li>twill ignores robots.txt.</li>
<li>twill does not understand javascript</li>
</ul>
</blockquote>
</div>
</div>
<div class="section" id="why-reimplement-pbp">
<h1><a class="toc-backref" href="#id19" name="why-reimplement-pbp">Why Reimplement PBP?</a></h1>
<p>PBP is a great idea, but Cory Dodt (the author of PBP) is focusing on
other things at the moment, and I needed a solid scripting language
for Web testing.  Plus, I wanted to play with mechanize.</p>
</div>
<div class="section" id="future-plans">
<h1><a class="toc-backref" href="#id20" name="future-plans">Future Plans</a></h1>
<p>I'm scratching my own itch with twill at the moment, so development of
the core functionality will proceed sporadically.  Right now I'm
starting to integrate it into my own projects, so expect many bug
fixes, soon...</p>
<p>TODO:</p>
<blockquote>
<ol class="arabic simple">
<li>test &amp; document the fieldname spec for fv; put into shell help.</li>
<li>unit testing in Python.</li>
<li>command-line option for initial URL, + command-line option to
fork server before executing twill.  (or special test script,
whatever.)</li>
<li>formfile &lt;formspec&gt; &lt;fieldspec&gt; &lt;filename&gt;</li>
<li>twill-sh -i as in python -i</li>
<li>twill-sh silence</li>
<li>__url__</li>
<li>submit on forms w/o submit button? (helgon...)</li>
<li>execute directories/directory trees?</li>
<li>switch between executing all files &amp; stopping on first error.</li>
<li>cookie &quot;1&quot; vs 1, in cookielib.</li>
<li>'go' for relative URLs; doc until fix.</li>
<li>fix spaces-in-URLs problem more generally;</li>
<li>&quot;fv 1 n value&quot; doesn't work, n ==&gt; number does.  ??</li>
<li>HTTP basic auth</li>
<li>Paul McGuire's pyparsing suggestions</li>
</ol>
</blockquote>
<p>Contributions are welcome &amp; will be duly acknowledged!</p>
</div>
<div class="section" id="acknowledgements-and-credits">
<h1><a class="toc-backref" href="#id21" name="acknowledgements-and-credits">Acknowledgements and Credits</a></h1>
<p>Cory Dodt had a great idea with PBP, and I thank him for his insight.
Ian Bicking gave me the idea of reimplementing PBP on top of IPython
(since abandoned in favor of <a class="reference" href="http://docs.python.org/lib/module-cmd.html">cmd</a>).  Grig Gheorghiu was strangely
enthusiastic about the simple demo I showed him.  John J. Lee has
promptly and enthusiastically checked in my various patches to
mechanize.  Michele Simionato is an early adopter who has helped quite
a bit.  Thanks, guys...</p>
<p>Bug reports have come in from the following fine people: Chris Miles,
MATSUNO Tokuhiro, and Elvelind Grandin.</p>
<p>Patches have been submitted by: Joeri van Ruth.</p>
<p>This document was written by C. Titus Brown, <a class="reference" href="mailto:titus&#64;caltech.edu">titus&#64;caltech.edu</a>.
Last updated May '05.
12.</p>
</div>
</div>
</body>
</html>
