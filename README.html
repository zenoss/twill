<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.7: http://docutils.sourceforge.net/" />
<title>twill: a simple language for testing Web applications</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="twill-a-simple-language-for-testing-web-applications">
<h1 class="title">twill: a simple language for testing Web applications</h1>
<div class="contents topic" id="contents">
<p class="topic-title first"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#what-is-twill" id="id2" name="id2">What is 'twill'?</a><ul>
<li><a class="reference" href="#use-cases" id="id3" name="id3">Use cases</a></li>
<li><a class="reference" href="#other-opinions" id="id4" name="id4">Other opinions</a></li>
<li><a class="reference" href="#other-tools" id="id5" name="id5">Other tools</a></li>
</ul>
</li>
<li><a class="reference" href="#command-reference" id="id6" name="id6">Command Reference</a><ul>
<li><a class="reference" href="#browsing" id="id7" name="id7">Browsing</a></li>
<li><a class="reference" href="#assertions" id="id8" name="id8">Assertions</a></li>
<li><a class="reference" href="#display" id="id9" name="id9">Display</a></li>
<li><a class="reference" href="#forms" id="id10" name="id10">Forms</a></li>
<li><a class="reference" href="#cookies" id="id11" name="id11">Cookies</a></li>
<li><a class="reference" href="#debugging" id="id12" name="id12">Debugging</a></li>
<li><a class="reference" href="#variable-handling" id="id13" name="id13">Variable handling</a></li>
<li><a class="reference" href="#other-commands" id="id14" name="id14">Other commands</a></li>
<li><a class="reference" href="#special-variables" id="id15" name="id15">Special variables</a></li>
<li><a class="reference" href="#details-on-form-handling" id="id16" name="id16">Details on form handling</a></li>
</ul>
</li>
<li><a class="reference" href="#requirements-availability-and-licensing" id="id17" name="id17">Requirements, Availability and Licensing</a><ul>
<li><a class="reference" href="#licensing" id="id18" name="id18">Licensing</a></li>
<li><a class="reference" href="#mailing-list" id="id19" name="id19">Mailing list</a></li>
</ul>
</li>
<li><a class="reference" href="#installation-and-using-twill" id="id20" name="id20">Installation and Using twill</a><ul>
<li><a class="reference" href="#proxy-servers" id="id21" name="id21">Proxy servers</a></li>
<li><a class="reference" href="#package-tests" id="id22" name="id22">Package tests</a></li>
<li><a class="reference" href="#recording-scripts" id="id23" name="id23">Recording scripts</a></li>
<li><a class="reference" href="#stress-testing" id="id24" name="id24">Stress testing</a></li>
<li><a class="reference" href="#running-and-using-tidy" id="id25" name="id25">Running and using tidy</a></li>
</ul>
</li>
<li><a class="reference" href="#twill-and-python" id="id26" name="id26">twill and Python</a><ul>
<li><a class="reference" href="#extending-twill" id="id27" name="id27">Extending twill</a></li>
<li><a class="reference" href="#using-twill-in-other-python-programs" id="id28" name="id28">Using twill in other Python programs</a></li>
<li><a class="reference" href="#unit-testing" id="id29" name="id29">Unit testing</a></li>
<li><a class="reference" href="#testing-wsgi-applications-in-process" id="id30" name="id30">Testing WSGI applications &quot;in-process&quot;</a></li>
<li><a class="reference" href="#advanced-documentation" id="id31" name="id31">Advanced documentation</a></li>
<li><a class="reference" href="#miscellaneous-implementation-details" id="id32" name="id32">Miscellaneous implementation details</a></li>
</ul>
</li>
<li><a class="reference" href="#future-plans" id="id33" name="id33">Future Plans</a></li>
<li><a class="reference" href="#acknowledgements-and-credits" id="id34" name="id34">Acknowledgements and Credits</a></li>
</ul>
</div>
<div class="section" id="what-is-twill">
<h1><a class="toc-backref" href="#id2" name="what-is-twill">What is 'twill'?</a></h1>
<p>twill is a tool for Web application testing.  twill implements a
simple scripting language that can be used interactively or from
scripts; this language contains commands for browsing the Web,
filling out forms, and asserting various conditions.  twill can
explore Web sites both interactively and via a script.</p>
<p>twill scripts look something like this:</p>
<pre class="literal-block">
# go to my Quixote demo page
go http://issola.caltech.edu/~t/qwsgi/qwsgi-demo.cgi/

# go to the widgets sub-page
go ./widgets
showforms

# fill out the form
formclear 1
fv 1 name test
fv 1 password testpass
fv 1 confirm yes
showforms

# submit form
submit 0

# show results
show

# confirm success, etc.
code 200
find testpass
</pre>
<p>twill commands can also be used directly from Python.</p>
<p>The primary use for twill is to do automated testing of Web
applications via a straightforward declarative language.  However,
it also provides a friendly, programmable interface for interacting
with Web sites.</p>
<p>twill was originally based on Cory Dodt's &quot;Python Browser Poseur&quot;,
a.k.a. <a class="reference" href="http://pbp.berlios.de/">PBP</a>.  It has diverged quite a bit since then.</p>
<div class="section" id="use-cases">
<h2><a class="toc-backref" href="#id3" name="use-cases">Use cases</a></h2>
<p>Here are some of things that I'm using twill for, or that I plan to use
it for:</p>
<blockquote>
<ul class="simple">
<li>unit-testing Web applications, esp. <a class="reference" href="http://www.python.org/peps/pep-0333.html">WSGI</a> and <a class="reference" href="http://www.mems-exchange.org/software/quixote/">Quixote</a> Python applications;</li>
<li>checking that Web sites are alive;</li>
<li>demonstrating specific problems with my (and other) Web sites;</li>
<li>interacting with Mailman lists;</li>
<li>stress-testing applications with multiple hits;</li>
</ul>
</blockquote>
<p>Send me an e-mail if you have additional uses.</p>
</div>
<div class="section" id="other-opinions">
<h2><a class="toc-backref" href="#id4" name="other-opinions">Other opinions</a></h2>
<p>Grig Gheorgiu has written a blog entry on <a class="reference" href="http://agiletesting.blogspot.com/2005/09/web-app-testing-with-python-part-3.html">Web app testing using twill</a>.
Michele Simionato wrote a nice long article on <a class="reference" href="http://www.onlamp.com/pub/a/python/2005/11/03/twill.html">Testing Web Apps</a>, and
Nitesh Djanjani <a class="reference" href="http://www.oreillynet.com/pub/wlg/8201">tried it out</a> as well.</p>
</div>
<div class="section" id="other-tools">
<h2><a class="toc-backref" href="#id5" name="other-tools">Other tools</a></h2>
<p>For those who want to use Python-based toolkits to test their Web
apps, there are a lot of great options.  Here are the ones I know
about:</p>
<p><a class="reference" href="http://pbp.berlios.de/">PBP</a> is very similar to twill, but the project seems to be
more-or-less defunct.  There are still one or two things that
PBP does that twill doesn't, but we're working on that ;).
Both twill and PBP are based on <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a>.</p>
<p><a class="reference" href="http://funkload.nuxeo.org/">funkload</a> is a nifty looking tool that does functional load testing.
It is built on <a class="reference" href="http://webunit.sourceforge.net/">webunit</a>.</p>
<p><a class="reference" href="http://www.cherrypy.org/file/trunk/cherrypy/test/webtest.py">webtest</a> is an extension to <tt class="docutils literal"><span class="pre">unittest</span></tt> for testing Web frameworks.
It's primarily used for CherryPy, I think.</p>
<p><a class="reference" href="http://cheeseshop.python.org/pypi?:action=display&amp;name=zope.testbrowser">zope.testbrowser</a> is a wrapper around <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> that exposes a more
convenient interface for testing.  Check out the <a class="reference" href="http://svn.zope.org/*checkout*/Zope3/trunk/src/zope/testbrowser/README.txt">zope.testbrowser README</a>
for more information.</p>
<p><a class="reference" href="http://python.org/pypi/mechanoid">mechanoid</a> is a fork of <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> that claims many bug fixes and a
different programming style.  It's primarily used for scripting Web
sites, not for testing, but it can easily be used for testing.</p>
<p><a class="reference" href="http://pamie.sourceforge.net/">PAMIE</a> and <a class="reference" href="http://kb.mozillazine.org/PyXPCOM">PyXPCOM</a> provide a Python interface for interacting with IE
and Mozilla-based browsers, respectively.</p>
<p>Finally, <a class="reference" href="http://confluence.public.thoughtworks.org/display/SEL/Home">Selenium</a> is an in-browser testing system that several people
have given rave reviews.  Check out this <a class="reference" href="http://agiletesting.blogspot.com/2005/10/article-on-selenium-in-october-issue.html">article on Selenium</a> for
some starting tips.  Note that it's not written in Python...</p>
<p>You might also consider checking out Ian Bicking's proto-implementation
of <a class="reference" href="http://blog.ianbicking.org/twill-in-javascript.html">twill in Javascript</a>.</p>
<p>(Thanks to Grig Gheorghiu for assembling much of this list!)</p>
</div>
</div>
<div class="section" id="command-reference">
<h1><a class="toc-backref" href="#id6" name="command-reference">Command Reference</a></h1>
<p>The following commands are built into twill.  Note that all text after
a '#' is ignored as a comment, unless it's in a quoted string.</p>
<div class="section" id="browsing">
<h2><a class="toc-backref" href="#id7" name="browsing">Browsing</a></h2>
<p><strong>go</strong> <em>&lt;url&gt;</em> -- visit the given URL.</p>
<p><strong>back</strong> -- return to the previous URL.</p>
<p><strong>reload</strong> -- reload the current URL.</p>
<p><strong>follow</strong> <em>&lt;link name&gt;</em> -- follow the given link.</p>
</div>
<div class="section" id="assertions">
<h2><a class="toc-backref" href="#id8" name="assertions">Assertions</a></h2>
<p><strong>code</strong> <em>&lt;code&gt;</em> -- assert that the last page loaded had this HTTP status,
e.g. <tt class="docutils literal"><span class="pre">code</span> <span class="pre">200</span></tt> asserts that the page loaded fine.</p>
<p><strong>find</strong> <em>&lt;regexp&gt;</em> -- assert that the page contains this regular expression. The variable <tt class="docutils literal"><span class="pre">__match__</span></tt> is set to the matching string.</p>
<p><strong>notfind</strong> <em>&lt;regexp&gt;</em> -- assert that the page <em>does not</em> contain this
regular expression.</p>
<p><strong>url</strong> <em>&lt;regexp&gt;</em> -- assert that the current URL matches the given regexp.  The variable <tt class="docutils literal"><span class="pre">__match__</span></tt> is set to the matching string.</p>
<p><strong>title</strong> <em>&lt;regexp&gt;</em> -- assert that the title of this page matches this regular expression.  The variable <tt class="docutils literal"><span class="pre">__match__</span></tt> is set to the matching string.</p>
</div>
<div class="section" id="display">
<h2><a class="toc-backref" href="#id9" name="display">Display</a></h2>
<p><strong>show</strong> -- show the current page's HTML.</p>
<p><strong>showlinks</strong> -- show all of the links on the current page.</p>
<p><strong>showforms</strong> -- show all of the forms on the current page.</p>
<p><strong>showhistory</strong> -- show the browser history.</p>
<p><strong>echo</strong> <em>&lt;string&gt;</em> -- echo the string to the screen.</p>
<p><strong>save_html</strong> <em>&lt;filename&gt;</em> -- save the current page's HTML into a file.</p>
</div>
<div class="section" id="forms">
<h2><a class="toc-backref" href="#id10" name="forms">Forms</a></h2>
<p><strong>submit</strong> <em>[&lt;n&gt;]</em> -- click the n'th submit button, if given;
otherwise submit via the last submission button clicked; if nothing
clicked, use the first submit button on the form.  See <a class="reference" href="#id1">details on
form handling</a> for more information.</p>
<p><strong>formvalue</strong> <em>&lt;formnum&gt; &lt;fieldname&gt; &lt;value&gt;</em> --- set the given field in the
given form to the given value.  For read-only form widgets/controls, the
click may be recorded for use by <strong>submit</strong>, but the value is not changed
unless the 'config' command has changed the default behavior.
See 'config' and <a class="reference" href="#id1">details on form handling</a> for more information on
the 'formvalue' command.</p>
<p><strong>fv</strong> -- abbreviation for 'formvalue'.</p>
<p><strong>formaction</strong> <em>&lt;formnum&gt; &lt;action&gt;</em> -- change the form action URL to the given URL.</p>
<p><strong>fa</strong> -- abbreviation for 'fa'.</p>
<p><strong>formclear</strong> -- clear all values in the form.</p>
<p><strong>formfile</strong> <em>&lt;formspec&gt; &lt;fieldspec&gt; &lt;filename&gt; [ &lt;content_type&gt; ]</em> -- attach a file to a file upload button by filename.</p>
</div>
<div class="section" id="cookies">
<h2><a class="toc-backref" href="#id11" name="cookies">Cookies</a></h2>
<p><strong>save_cookies</strong> <em>&lt;filename&gt;</em> -- save current cookie jar into a file.</p>
<p><strong>load_cookies</strong> <em>&lt;filename&gt;</em> -- replace current cookie jar with file contents.</p>
<p><strong>clear_cookies</strong> -- clear all of the current cookies.</p>
<p><strong>show_cookies</strong> -- show all of the current cookies.</p>
</div>
<div class="section" id="debugging">
<h2><a class="toc-backref" href="#id12" name="debugging">Debugging</a></h2>
<p><strong>debug</strong> <em>&lt;what&gt;</em> <em>&lt;level&gt;</em> -- turn on or off debugging/tracing for various functions.  The first argument is either 'http' to show HTTP headers, or 'twill' to show twill commands.  The second argument is '0' for off, '1' for on.</p>
</div>
<div class="section" id="variable-handling">
<h2><a class="toc-backref" href="#id13" name="variable-handling">Variable handling</a></h2>
<p><strong>setglobal</strong> <em>&lt;name&gt; &lt;value&gt;</em> -- set variable &lt;name&gt; to value &lt;value&gt; in
global dictionary</p>
<p><strong>setlocal</strong> <em>&lt;name&gt; &lt;value&gt;</em> -- set variable &lt;name&gt; to value &lt;value&gt; in
local dictionary</p>
<p>The local dictionary is file-specific, while the global module is general
to all the commands.  Local variables will override global variables if
they exist.</p>
</div>
<div class="section" id="other-commands">
<h2><a class="toc-backref" href="#id14" name="other-commands">Other commands</a></h2>
<p><strong>tidy_ok</strong> -- check to see if 'tidy' runs on this page without any errors or warnings.  (<cite>tidy</cite> is very stringent -- you've been warned!)</p>
<p><strong>exit</strong> <em>[&lt;code&gt;]</em> -- exit with the given integer code, if specified.  'code' defaults to 0.</p>
<p><strong>run</strong> <em>&lt;command&gt;</em> -- execute the given Python command.</p>
<p><strong>runfile</strong> <em>&lt;file1&gt; [ &lt;file2&gt; ... ]</em> -- execute the given files.</p>
<p><strong>agent</strong> -- set the browser's &quot;User-agent&quot; string.</p>
<p><strong>sleep</strong> <em>[&lt;seconds&gt;]</em> -- sleep the given number of seconds.  Defaults to 1 second.</p>
<p><strong>reset_browser</strong> -- reset the browser.</p>
<p><strong>extend_with</strong> <em>&lt;module&gt;</em> -- import commands from Python module.  This acts
like <tt class="docutils literal"><span class="pre">from</span> <span class="pre">&lt;module&gt;</span> <span class="pre">import</span> <span class="pre">*</span></tt> does in Python, so e.g. a function
<tt class="docutils literal"><span class="pre">fn</span></tt> in <tt class="docutils literal"><span class="pre">extmodule</span></tt> would be available as <tt class="docutils literal"><span class="pre">fn</span></tt>.  See <em>examples/extend_example.py</em> for an example.</p>
<p><strong>getinput</strong> <em>&lt;prompt&gt;</em> -- get keyboard input and store it in <tt class="docutils literal"><span class="pre">__input__</span></tt>.</p>
<p><strong>getpassword</strong> <em>&lt;prompt&gt;</em> -- get <em>silent</em> keyboard input and store
it in <tt class="docutils literal"><span class="pre">__password__</span></tt>.</p>
<p><strong>add_auth</strong> <em>&lt;realm&gt; &lt;uri&gt; &lt;user&gt; &lt;password&gt;</em> -- add HTTP Basic Authentication information for the given realm/URI combination.  For example,</p>
<pre class="literal-block">
add_auth IdyllStuff http://www.idyll.org/ titus test
</pre>
<p>would tell twill that a request from the authentication realm
&quot;IdyllStuff&quot; under <a class="reference" href="http://www.idyll.org/">http://www.idyll.org/</a> should be answered with
username 'titus', password 'test'.</p>
<p><strong>config</strong> [<em>&lt;key&gt;</em> [<em>&lt;value&gt;</em>]] -- show/set configuration options.</p>
</div>
<div class="section" id="special-variables">
<h2><a class="toc-backref" href="#id15" name="special-variables">Special variables</a></h2>
<p><strong>__input__</strong> -- result of last <strong>getinput</strong>.</p>
<p><strong>__password__</strong> -- result of last <strong>getpassword</strong>.</p>
<p><strong>__url__</strong> -- current URL.</p>
</div>
<div class="section" id="details-on-form-handling">
<h2><a class="toc-backref" href="#id16" name="details-on-form-handling">Details on form handling</a></h2>
<a class="target" id="id1" name="id1"></a><p>Both the <cite>formvalue</cite> (or <cite>fv</cite>) and <cite>submit</cite> commands rely on a certain
amount of implicit cleverness to do their work.  In odd situations, it
can be annoying to determine exactly what form field <cite>formvalue</cite> is
going to pick based on your field name, or what form &amp; field <cite>submit</cite>
is going to &quot;click&quot; on.</p>
<p>Here is the pseudocode for how <cite>formvalue</cite> and <cite>submit</cite> figure out
what form to use (function <cite>twill.commands.browser.get_form</cite>):</p>
<pre class="literal-block">
for each form on page:
    if supplied regexp pattern matches the form name, select

if no form name, try converting to an integer N &amp; using N-1 as
an index into the list or forms on the page (i.e. form 1 is the
first form on the page).
</pre>
<p>Here is the pseudocode for how <cite>formvalue</cite> and <cite>submit</cite> figure out
what form field to use (function <cite>twill.commands.browser.get_form_field</cite>):</p>
<pre class="literal-block">
search current form for control name with exact match to fieldname;
if single (unique) match, select.

if no match, convert fieldname into a number and use as an index, if
possible.

if no match, search current form for control name with regexp match to fieldname;
if single (unique) match, select.

if *still* no match, look for exact matches to submit-button values.
if single (unique) match, select.
</pre>
<p>Here is the pseudocode for <cite>submit</cite>:</p>
<pre class="literal-block">
if a form was _not_ previously selected by formvalue:
   if there's only one form on the page, select it.
   otherwise, fail.

if a field is not explicitly named:
   if a submit button was &quot;clicked&quot; with formvalue, use it.
   otherwise, use the first submit button on the form, if any.
otherwise:
   find the field using the same rules as formvalue

finally, if a button has been picked, submit using it;
otherwise, submit without using a button
</pre>
</div>
</div>
<div class="section" id="requirements-availability-and-licensing">
<h1><a class="toc-backref" href="#id17" name="requirements-availability-and-licensing">Requirements, Availability and Licensing</a></h1>
<p>twill is developed in python 2.3, and should work fine with python 2.4.
You don't need any other software; both <a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> and <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> are
required, but they are included with twill.</p>
<p>If <tt class="docutils literal"><span class="pre">tidy</span></tt> is installed and available in the path, twill will use it
in several ways.  See below for more information.</p>
<p>Version 0.8 is available for download <a class="reference" href="http://darcs.idyll.org/~t/projects/twill-0.8.tar.gz">here</a>.  The latest development
version can always be found at <a class="reference" href="http://darcs.idyll.org/~t/projects/twill-latest.tar.gz">twill-latest.tar.gz</a>.  There's a darcs
repository for the project at
<a class="reference" href="http://darcs.idyll.org/~t/projects/twill/">http://darcs.idyll.org/~t/projects/twill/</a>.</p>
<p>To obtain twill using darcs, install darcs and then type</p>
<pre class="literal-block">
darcs get http://darcs.idyll.org/~t/projects/twill/
</pre>
<p>To propose a change to the lead developer, after making the changes</p>
<pre class="literal-block">
darcs record -am &quot;explanation of change&quot;
darcs send -a
</pre>
<p>To pull in changes made by the lead developer some time later</p>
<pre class="literal-block">
darcs pull
</pre>
<div class="section" id="licensing">
<h2><a class="toc-backref" href="#id18" name="licensing">Licensing</a></h2>
<p>twill 0.8 is licensed under the <a class="reference" href="http://www.gnu.org/copyleft/lesser.html">GNU LGPL</a>, although I am amenable
to changing to an MIT-like license in the future.  All code currently
contained in twill is Copyright (C) 2005, C. Titus Brown
&lt;<a class="reference" href="mailto:titus&#64;caltech.edu">titus&#64;caltech.edu</a>&gt;.</p>
<p>In plain English: I own the code, but you're welcome to use it and
even subsume it into other projects.  Either way you are currently
obligated to make any changes to twill publicly available, in source
code form, if and only if you are distributing those changes in some
<em>other</em> form (e.g. as part of another package).  You do <em>not</em> need to
provide the source to packages that use twill, and you are not
obligated to publish your own private changes to twill.  You do not need
to publish your twill scripts or twill extensions, either.</p>
<p><a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> and <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> are both included with twill, but are under
their own licenses.  (Both are currently more lenient than the LGPL,
so you should have no problems.)</p>
</div>
<div class="section" id="mailing-list">
<h2><a class="toc-backref" href="#id19" name="mailing-list">Mailing list</a></h2>
<p>There is a <a class="reference" href="http://lists.idyll.org/listinfo/twill">twill mailing list</a> for discussion and help purposes; for
announcements, either subscribe to the twill list, or monitor
<tt class="docutils literal"><span class="pre">comp.lang.python.announce</span></tt>/PyPi.  You can also check out the
<a class="reference" href="http://lists.idyll.org/pipermail/twill/">archives</a>.</p>
</div>
</div>
<div class="section" id="installation-and-using-twill">
<h1><a class="toc-backref" href="#id20" name="installation-and-using-twill">Installation and Using twill</a></h1>
<p>To install twill, just run</p>
<pre class="literal-block">
python setup.py install
</pre>
<p>To run twill, type 'twill-sh' and try</p>
<pre class="literal-block">
go http://www.python.org/
show
</pre>
<p>You can also run scripts (e.g. the files in <tt class="docutils literal"><span class="pre">examples/</span></tt>) directly by
specifying them on the command line.</p>
<p>See the output of 'twill-sh -h' for help on command line options.</p>
<p>There are several example scripts under the <tt class="docutils literal"><span class="pre">examples/</span></tt>
subdirectory.  Included in the examples is a test of the Quixote demo
site, and a script for clearing out SourceForge Mailman lists.  The
latter script makes use of the (very simple!) extension feature, if
you're interested...</p>
<div class="section" id="proxy-servers">
<h2><a class="toc-backref" href="#id21" name="proxy-servers">Proxy servers</a></h2>
<p>twill understands the <tt class="docutils literal"><span class="pre">http_proxy</span></tt> environment variable generically
used to set proxy server information.  To use a proxy in UNIX or
Windows, just set the <tt class="docutils literal"><span class="pre">http_proxy</span></tt> environment variable, e.g.</p>
<pre class="literal-block">
% export http_proxy=&quot;http://www.someproxy.com:3128&quot;
</pre>
<p>or</p>
<pre class="literal-block">
% setenv http_proxy=&quot;http://www.someotherproxy.com:3148&quot;
</pre>
</div>
<div class="section" id="package-tests">
<h2><a class="toc-backref" href="#id22" name="package-tests">Package tests</a></h2>
<p>twill comes with several unit tests.  They depend on <a class="reference" href="http://somethingaboutorange.com/mrl/projects/nose/">nose</a> and
<a class="reference" href="http://www.mems-exchange.org/software/quixote/">Quixote 2.3</a>.  To run them, simply type 'nosetests' in the top
package directory.</p>
</div>
<div class="section" id="recording-scripts">
<h2><a class="toc-backref" href="#id23" name="recording-scripts">Recording scripts</a></h2>
<p>Writing twill scripts is boring.  One simple way to get at least a
rough initial script is to use the <a class="reference" href="http://maxq.tigris.org/">maxq</a> recorder to generate a twill
script.  <a class="reference" href="http://maxq.tigris.org/">maxq</a> acts as an HTTP proxy and records all HTTP traffic; I
have written a simple twill script generator for it.  The script
generator and installation docs are included in the twill distribution
under the directory <tt class="docutils literal"><span class="pre">maxq/</span></tt>.</p>
</div>
<div class="section" id="stress-testing">
<h2><a class="toc-backref" href="#id24" name="stress-testing">Stress testing</a></h2>
<p>You can use the <cite>twill-fork</cite> script to do some stress testing.  The syntax is</p>
<pre class="literal-block">
twill-fork -n &lt;number to execute&gt; -p &lt;number of processes&gt; script [ scripts... ]
</pre>
<p>For example,</p>
<pre class="literal-block">
twill-fork -n 500 -p 10 test-script
</pre>
<p>will fork 10 times and run <cite>test-script</cite> 50 times in each process.
<cite>twill-fork</cite> will record the time it takes to run all of the scripts specified
on the command and print a summary at the end.</p>
<p>The time recorded is <em>not</em> the CPU time used.  (This would lead to an
inaccurate estimate because the client code uses blocking calls to
retrieve Web pages.)  Rather, the time recorded is the clock time
measured between the start and end of script execution.</p>
<p>Try <cite>twill-fork -h</cite> to get a list of other command line arguments.</p>
<p>Note that twill-fork still needs a lot of work...</p>
</div>
<div class="section" id="running-and-using-tidy">
<h2><a class="toc-backref" href="#id25" name="running-and-using-tidy">Running and using tidy</a></h2>
<p>The <tt class="docutils literal"><span class="pre">tidy</span></tt> program does a nice job of producing correct HTML from
mangled, broken, eeevil Web pages.  By default, twill will run pages
through <tt class="docutils literal"><span class="pre">tidy</span></tt> before processing them.  This is on by default
because the Python libraries that parse HTML are very bad at dealing
with incorrect HTML, and will often return incorrect results on &quot;real
world&quot; Web pages.</p>
<p>To disable this feature, set <tt class="docutils literal"><span class="pre">config</span> <span class="pre">do_run_tidy</span> <span class="pre">0</span></tt>.</p>
<p>If <tt class="docutils literal"><span class="pre">tidy</span></tt> is not installed, twill will silently ignore it.  It may
be desirable to <em>require</em> a functioning <tt class="docutils literal"><span class="pre">tidy</span></tt> installation; so, to fail
when <tt class="docutils literal"><span class="pre">tidy</span></tt> <em>isn't</em> installed, set <tt class="docutils literal"><span class="pre">config</span> <span class="pre">tidy_should_exist</span> <span class="pre">1</span></tt>.</p>
<p>See the <a class="reference" href="http://tidy.sourceforge.net/">tidy page</a> for more information on <tt class="docutils literal"><span class="pre">tidy</span></tt>.</p>
</div>
</div>
<div class="section" id="twill-and-python">
<h1><a class="toc-backref" href="#id26" name="twill-and-python">twill and Python</a></h1>
<p>twill is essentially a thin shell around the
<a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> package.  All twill commands are implemented in the
<tt class="docutils literal"><span class="pre">commands.py</span></tt> file, and <a class="reference" href="http://pyparsing.sourceforge.net/">pyparsing</a> does the work of parsing the
input and converting it into Python commands (see <tt class="docutils literal"><span class="pre">parse.py</span></tt>).
Interactive shell work and readline support is implemented via the
<a class="reference" href="http://docs.python.org/lib/module-cmd.html">cmd</a> module (from the standard Python library).</p>
<div class="section" id="extending-twill">
<h2><a class="toc-backref" href="#id27" name="extending-twill">Extending twill</a></h2>
<p>Right now twill is very easy to extend: just build a Python module
that exports the functions you want to call, place it in the
PYTHONPATH, and run <tt class="docutils literal"><span class="pre">extend_with</span> <span class="pre">&lt;modulename&gt;</span></tt>.  See
<tt class="docutils literal"><span class="pre">extensions/mailman_sf.py</span></tt> for an extension that helps deal
with mailman lists on SourceForge; this extension is used by
<tt class="docutils literal"><span class="pre">examples/discard-sf-mailman-msgs</span></tt>.</p>
<p>Notes:</p>
<blockquote>
<ul class="simple">
<li>If your extension raises <tt class="docutils literal"><span class="pre">SystemExit</span></tt>, twill will stop
processing the script.  This is a useful way to build in
conditionals, e.g. see the <tt class="docutils literal"><span class="pre">discard-sf-mailman-msgs</span></tt> example
script.</li>
</ul>
</blockquote>
</div>
<div class="section" id="using-twill-in-other-python-programs">
<h2><a class="toc-backref" href="#id28" name="using-twill-in-other-python-programs">Using twill in other Python programs</a></h2>
<p>All of the commands available in twill are implemented as top-level functions
in the <cite>twill.commands</cite> module.  For example, to use twill functionality from
another Python program, you can do:</p>
<pre class="literal-block">
from twill.commands import go, showforms, formclear, fv, submit

go('http://issola.caltech.edu/~t/qwsgi/qwsgi-demo.cgi/')
go('./widgets')
showforms()

formclear('1')
fv(&quot;1&quot;, &quot;name&quot;, &quot;test&quot;)
fv(&quot;1&quot;, &quot;password&quot;, &quot;testpass&quot;)
fv(&quot;1&quot;, &quot;confirm&quot;, &quot;yes&quot;)
showforms()

submit('0')
</pre>
<p>Note that all arguments need to be strings, at least for the moment.</p>
<p>twill also provides a simple wrapper for <a class="reference" href="http://wwwsearch.sf.net/">mechanize</a> functionality, in
the <cite>browser.py</cite> module.  This may be useful for twill extensions as
well as for other toolkits, but the API is still unstable.</p>
</div>
<div class="section" id="unit-testing">
<h2><a class="toc-backref" href="#id29" name="unit-testing">Unit testing</a></h2>
<p>twill can be used in unit testing, and it contains
some Python support infrastructure for this purpose.</p>
<p>As an example, here's the code from twill's own unit test, testing the
unit-test support code:</p>
<pre class="literal-block">
import os
import testlib
import twill.unit
import twilltestserver
from quixote.server.simple_server import run as quixote_run

def test():
    # port to run the server on
    PORT=8090

    # create a function to run the server
    def run_server_fn():
        quixote_run(twilltestserver.create_publisher, port=PORT)

    # abspath to the script
    script = os.path.join(testlib.testdir, 'test-unit-support.twill')

    # create test_info object
    test_info = twill.unit.TestInfo(script, run_server_fn, PORT)

    # run tests!
    twill.unit.run_test(test_info)
</pre>
<p>Here, I'm unit testing the Quixote application <tt class="docutils literal"><span class="pre">twilltestserver</span></tt>, which
is run by <tt class="docutils literal"><span class="pre">quixote_run</span></tt> (a.k.a. <tt class="docutils literal"><span class="pre">quixote.server.simple_server.run</span></tt>) on
port <tt class="docutils literal"><span class="pre">PORT</span></tt>, using the twill script <tt class="docutils literal"><span class="pre">test-unit-support.twill</span></tt>.  That
script contains this code:</p>
<pre class="literal-block">
# starting URL is provided to it by the unit test support framework.

go ./multisubmitform
code 200
</pre>
<p>A few things to note:</p>
<blockquote>
<ul class="simple">
<li>the initial URL is set based on the URL reported by <tt class="docutils literal"><span class="pre">TestInfo</span></tt>,
which calculates it based on the <tt class="docutils literal"><span class="pre">PORT</span></tt> argument.  (This can be overriden
by subclasses.)</li>
<li><tt class="docutils literal"><span class="pre">TestInfo</span></tt> contains code to (a) run the server function in a new
process, and (b) run the twill script against that server.  It then
kills the server after script completion.</li>
</ul>
</blockquote>
<p>This is still new code, and it would be good to hear people's opinions.</p>
</div>
<div class="section" id="testing-wsgi-applications-in-process">
<h2><a class="toc-backref" href="#id30" name="testing-wsgi-applications-in-process">Testing WSGI applications &quot;in-process&quot;</a></h2>
<p>twill has some built-in support for testing <a class="reference" href="http://www.python.org/peps/pep-0333.html">WSGI
applications</a>.</p>
<p>twill contains two functions,
<cite>add_wsgi_intercept</cite> and <cite>remove_wsgi_intercept</cite>, that allow Python
applications to redirect HTTP calls into a WSGI application
&quot;in-process&quot;, without going via an external Internet call.  This is
particularly useful for unit tests, where setting up an externally
available Web server can be inconvenient.</p>
<p>For example, the following code redirects all <tt class="docutils literal"><span class="pre">localhost:80</span></tt> calls to
the given WSGI app:</p>
<pre class="literal-block">
def create_app():
    return wsgi_app

twill.add_wsgi_intercept('localhost', 80, create_app)
</pre>
<p>See the <tt class="docutils literal"><span class="pre">tests/test-wsgi-intercept.py</span></tt> unit test for more information.</p>
</div>
<div class="section" id="advanced-documentation">
<h2><a class="toc-backref" href="#id31" name="advanced-documentation">Advanced documentation</a></h2>
<p>twill uses a melange of different packages.  Here are some potentially
useful links:</p>
<blockquote>
<ul class="simple">
<li><a class="reference" href="http://www.voidspace.org.uk/python/articles/urllib2.shtml">urllib2.py: the missing manual</a> -- a detailed discussion of urllib2
functionality that can be directly applied to twill.</li>
</ul>
</blockquote>
</div>
<div class="section" id="miscellaneous-implementation-details">
<h2><a class="toc-backref" href="#id32" name="miscellaneous-implementation-details">Miscellaneous implementation details</a></h2>
<blockquote>
<ul class="simple">
<li>twill ignores robots.txt.</li>
<li>twill does not understand javascript.</li>
</ul>
</blockquote>
</div>
</div>
<div class="section" id="future-plans">
<h1><a class="toc-backref" href="#id33" name="future-plans">Future Plans</a></h1>
<p>TODO:</p>
<p>0.8 release:</p>
<blockquote>
<ol class="arabic simple">
<li>HTTP-EQUIV refresh/redirect commands w/in mechanize? (issola.caltech.edu/~t/transfer/redir-test.html)</li>
<li>Test HTTP basic auth &amp; basic auth (<a class="reference" href="http://www.quixote.ca/qx/HttpBasicAuthentication">http://www.quixote.ca/qx/HttpBasicAuthentication</a>?) example.</li>
</ol>
</blockquote>
<p>after that:</p>
<blockquote>
<ol class="arabic simple">
<li>break &quot;unit tests&quot; down into smaller units.</li>
<li>execute directories/directory trees?</li>
<li>record scripts fix.</li>
<li>systematize variable handling a bit better: __ vs $</li>
<li>expose 'browser' &amp; document re Grig; regexp esp.</li>
<li>twill-fork: make file writing stuff optional; test massive fork fn.</li>
<li>eggggz.</li>
<li>think about 'go' &amp; test-go.</li>
</ol>
</blockquote>
<p>Longer term fixes &amp; cleanups:</p>
<blockquote>
<ol class="arabic simple">
<li>fix spaces-in-URLs problem more generally (in urllib2).</li>
<li>Paul McGuire's pyparsing suggestions.</li>
<li>cookie &quot;1&quot; vs 1, in cookielib.</li>
<li>command line completion doesn't understand extend_with results yet.</li>
<li>extend_with etc. -- module namespaces, e.g. extmodule.fn?</li>
<li>doc reorganization: separate out commands, make source docs.</li>
<li>implement more complex proxy support.  proxies proxies proxies.</li>
<li>add config directives for socket timeout.</li>
</ol>
</blockquote>
<p>Random ideas:</p>
<blockquote>
<ol class="arabic">
<li><p class="first">Build twill interfaces for zope.testbrowser and mechanoid.</p>
<p>(This shouldn't be too difficult, since both are based on mechanize...)</p>
</li>
<li><p class="first">Write a sizeable Web app and then test it with all of the different tools,
above.</p>
<p>Draw broad conclusions that are unsubstantiated by the work.</p>
</li>
<li><p class="first">Develop twill-like languages for <a class="reference" href="http://pamie.sourceforge.net/">PAMIE</a> and <a class="reference" href="http://kb.mozillazine.org/PyXPCOM">PyXPCOM</a>.  Note that the
hard work, at least for PAMIE, is already done; check out the
<a class="reference" href="tutoriala.html">PAMIE examples page</a>.</p>
</li>
</ol>
</blockquote>
<p>Contributions are welcome &amp; will be duly acknowledged!</p>
</div>
<div class="section" id="acknowledgements-and-credits">
<h1><a class="toc-backref" href="#id34" name="acknowledgements-and-credits">Acknowledgements and Credits</a></h1>
<p>twill was designed and written by C. Titus Brown.  All of the good
design ideas were stolen from other people; all of the bad ones are
my fault.</p>
<p>Cory Dodt had a great idea with PBP, and I thank him for his insight.
Ian Bicking gave me the idea of reimplementing PBP on top of IPython
(since abandoned in favor of <a class="reference" href="http://docs.python.org/lib/module-cmd.html">cmd</a>), and suggested the &quot;in-process&quot;
hack.  Grig Gheorghiu was strangely enthusiastic about the simple demo
I showed him and has religiously promoted twill ever since.  John
J. Lee has promptly and enthusiastically checked in my various patches
to mechanize.  Michele Simionato is an early adopter who has helped
quite a bit.  Thanks, guys...</p>
<p>Bug reports have come in from the following fine people: Chris Miles,
MATSUNO Tokuhiro, Elvelind Grandin, Mike Rovner, and sureshvv.</p>
<p>Patches have been submitted by Joeri van Ruth, Paul McGuire, Ed Rahn,
Nic Ferrier, Robert Leftwich, James Cameron, William Volkman,
Tommi Virtanen, Simon Buenzli, and sureshvv.  Thanks!</p>
<hr class="docutils" />
<p>This document was written by C. Titus Brown, <a class="reference" href="mailto:titus&#64;caltech.edu">titus&#64;caltech.edu</a>.
Last updated November '05.</p>
</div>
</div>
</body>
</html>
