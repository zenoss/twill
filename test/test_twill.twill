#### This is a script designed to test basic functionality for most of
#### the commands in twill.  The only things not tested are the commands
#### that only print stuff out.

go http://issola.caltech.edu:8080/
code 200

# intro page.

find "Your session ID is None"
find "this is visit #0"
find 'You are logged in as "None"'
notfind 'this is visit #1'

## reload and assign a session ID

reload
code 200
notfind "Your session ID is None"

# increment visit number.
follow increment
code 200
find "this is visit #1"

reload
code 200
find "this is visit #2"

# save & then clear cookies.
save_cookies 'test_twill.cookies'
clear_cookies

# return to main page; did clear work?

go ./
find "Your session ID is None"
find "this is visit #0"
find 'You are logged in as "None"'
notfind 'this is visit #2'

# yep!  all right. load cookies, check that.
load_cookies 'test_twill.cookies'

go ./
code 200
notfind "Your session ID is None"
find "this is visit #2"

# ok, cookies check out. now check login/access restricted.

go restricted/
code 403

back
go ./login

# test formclear
fv 1 username test
formclear 1
fv 1 submit me
submit
code 200
find "Log in:"


fv 1 username test
fv 1 submit me
submit

code 200
find 'You are logged in as "test"'
find 'this is visit #2'

save_cookies 'test_twill.cookies'
clear_cookies

# ok, clear username?
go ./
code 200
find 'You are logged in as "None"'

# yep, reload & visit restricted.
load_cookies 'test_twill.cookies'
go ./
code 200
find 'You are logged in as "test"'

go restricted/
code 200

# success!  log out, and try again.
go ../logout
go ./restricted
code 403

### test input/password

back
go ./login

getinput "Enter some (weird) input: "
fv 1 username __input__
submit

code 200
find __input__

echo 'found"' __input__ '"on the page, hooray!'

getpassword "Enter your (weird) secret identity: "
go ./login
fv 1 username __password__
submit

show

code 200
find __password__
echo 'found"' __password__ '"on the page, hooray!'
